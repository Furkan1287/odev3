{% extends "base.html" %}
{% block title%}
Chat App | Home
{% endblock %}
{% block css %}
<style>
    .chat-msg{
        height: 80vh;
    }
    #rec_user {
    overflow-y: auto;
    height: 85.5vh;
    }
</style>
{% endblock %}

{% block content %}
<form class="mx-md-4 mt-3 mx-auto" method ="POST" id="msg" name="msg">
    {% csrf_token %}
    <div class="row mt-4 mx-auto">
        <div class="col-md-2 ms-5">
            <select class="list-group" name="receiver" id="rec_user" size="100" required>
                {% for username,name in Users.items  %}
                    <option class="list-group-item list-group-item-action {% if rec == username %} active {% endif %}" label="{{username}} - {{name}}" value="{{username}}" {% if rec == username %} selected{% endif %}></option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-9 ms-3">
            <div id="chat-msg" class="chat-msg">
                {% for c,s in Chats %}
                <div class="row mx-1">
                    {% if s %}
                    <div class="col"></div>
                    <div class="col-auto alert alert-success">
                    {% else %}
                    <div class="col-auto alert alert-primary">
                    {% endif %}
                            {% for k,v in c.items %}
                                {% if k == "Message"%}
                                    {{v}}
                                {% else %}
                                    {% if k == "dateTime"%}
                                    <div class="form-text">
                                        {{v}}
                                    </div>
                                    {% endif %}
                                {% endif %}
                            {% endfor %}
                    </div>
                </div>
                {% endfor %}
            </div>
            <div class="input-group mt-1 mb-3">
              <input type="text" class="form-control" placeholder="Type Message... " name="message">
              <div class="input-group-append">
                <button class="btn btn-outline-success" type="submit" name="sendmsg"><i class="fa fa-paper-plane-o"></i> Send</button>
              </div>
            </div>
        </div>
    </div>
</form>


<script type="text/javascript">

    new SimpleBar(document.getElementById("chat-msg"));

    var container = document.querySelector('#chat-msg .simplebar-content-wrapper');
    container.scrollTo({ top: 1000000*$('#chat-msg')[0].scrollHeight, behavior: "smooth" });

    $(function(){
        $('#rec_user').change(function(){
            $('#msg').submit();
        });
    });

</script>

{% endblock %}