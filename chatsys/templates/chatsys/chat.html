{% extends "base.html" %}
{% block title%}
Chat App | Home
{% endblock %}
{% block css %}
<style>
    .chat-msg{
        height: 78vh;
        overflow-y: scroll;
    }
</style>
{% endblock %}

{% block content %}
<form class="mx-md-4 mt-3" method ="POST" id="msg" name="msg">
    {% csrf_token %}
    <div class="row mt-5 mx-1">
        <div class="col-md-2">
            <select list="userlist" class="form-control" name="receiver" id="rec_user" required>
                {% for username,name in Users.items  %}
                    <option label="{{username}} - {{name}}" value="{{username}}" {% if rec == username %} selected{% endif %}></option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-10">
            <div id="chat-msg" class="chat-msg">
                {% for c,s in Chats %}
                <div class="row mx-1">
                    {% if s %}
                    <div class="col"></div>
                    <div class="col-auto alert alert-success">
                    {% else %}
                    <div class="col-auto alert alert-primary">
                    {% endif %}
                            {% for k,v in c.items %}
                                {% if k == "Message"%}
                                    {{v}}
                                {% else %}
                                    {% if k == "dateTime"%}
                                    <div class="form-text">
                                        {{v}}
                                    </div>
                                    {% endif %}
                                {% endif %}
                            {% endfor %}
                    </div>
                </div>
                {% endfor %}
            </div>
            <div class="input-group mt-1 mb-3">
              <input type="text" class="form-control" placeholder="Type Message... " name="message">
              <div class="input-group-append">
                <button class="btn btn-outline-success" type="submit" name="sendmsg"><i class="fa fa-paper-plane-o"></i> Send</button>
              </div>
            </div>
        </div>
    </div>
</form>


<script type="text/javascript">

    function scrollToBottom() {
        let chatDiv = document.getElementById("chat-msg");
        chatDiv.scrollTop = chatDiv.scrollHeight;
    }

    scrollToBottom();

    $(function(){
         {% if not rec %} $('#msg').submit(); {% endif %}
        $('#rec_user').change(function(){
            $('#msg').submit();
        });
    });

</script>

{% endblock %}